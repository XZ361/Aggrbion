## 4.2 执行环境和作用域

    > 执行环境定义了变量和函数有权访问的其他数据，决定了他们各自的行为。每个执行环境都有一个与之关联的变量对象，环境中定义的所有变量和函数都保存在该对象中。虽然我们无法访问该对象，但是解析器在处理数据时会在后台使用它。

    全局执行环境是最外围的一个执行环境。
    
    当代码在一个环境中执行时，会创建变量对象的一个作用域链。

    作用域链的前端，始终都是当前执行代码所在环境的变量对象。如果该环境是函数，则将其活动对象作为变量对象。活动对象在最开始只包含一个变量，即arguments对象。作用域链中的下一个变量对象来自包含环境，而在下一个变量对象则来自下一个包含环境。这样一只延续到全局执行环境；全局执行环境中的变量对象始终都是作用域链中最后一个对象。

### 4.2.1 延长作用域链

    - try-catch语句的catch块
    - with语句
    这两种语句都会在作用域链的前端添加一个变量对象。
    对with语句来说，会将指定的对象添加到作用域链中；对catch语句来说，会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明。
    
    ```
        function buildUrl(){
            var qs = "?debug=true";
            with(location){
                var url = href + qs;
            }
            return url;
        }
    ```

### 4.2.2 没有块级作用域

    >Es6之前的js没有块级作用域。在其他类C语言中，由花括号封闭的代码块都有自己的作用域（就是他们自己的执行环境），因而支持根据条件来定义变量。

    对于块级作用域的语言，for语句初始化变量的表达式所定义的变量 ，只会存在于循环的环境之中；对于js 来说，for语句创建的变量i即使在循环语句结束后，也已就会存在于循环外部的执行环境中的

    ```
```     for(var i=0;i<10;i++){
            do(i);
        }
        alert(i);
    ```   

    ***1.声明变量***

    > var声明的变量会自动被添加到最接近的环境中。在函数内部，最接近的环境就是函数的局部环境；with语句中，最接近的环境就是函数环境。若初始化变量时没有使用var，该变量自动被添加到全局环境。

    ***2.查询标识符***

    >当某个环境中为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。如果在局部环境中找到了该标识符，搜索过程停止，变量就绪。如果在局部环境中没有找到该变量名，泽继续沿着作用域链向上搜索，搜索过程讲义直追索道全局环境的变量对象。如果全局环境中也没有找到这个标识符，这意味着该变量尚未声明。


